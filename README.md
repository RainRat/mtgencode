# Magic: The Gathering Card Encoder (mtgencode)

This tool helps you convert Magic: The Gathering card data into a format that AI models can read and learn from. It also converts the AI's output back into readable card text or visual spoilers.

**What this is for:**
*   **Machine Learning:** preparing data to train Neural Networks (like RNNs or Transformers) to generate new Magic cards.
*   **Decoding:** Turning the raw text generated by an AI back into readable cards or [Magic Set Editor](http://magicseteditor.boards.net) files.

---

## Installation

You can run this project using Docker (easier) or install it directly on your computer.

### Option 1: Docker (Recommended)
This method handles all dependencies for you.

*   **Linux/macOS:** Run `./docker-interactive.sh`
*   **Windows:** Run `./docker-interactive.bat`

### Option 2: Local Installation
If you prefer to run it directly on your machine:

1.  **Check Prerequisites:**
    Ensure you have Python 3.9 or newer installed.
    ```bash
    python3 --version
    ```

2.  **Get the Code:**
    ```bash
    git clone https://github.com/billzorn/mtgencode.git
    cd mtgencode
    ```

3.  **Install Libraries:**
    ```bash
    pip install -r requirements.txt
    ```

4.  **Download Language Data:**
    This tool uses NLTK for text processing. Run this command to download the necessary data:
    ```bash
    python3 -m nltk.downloader punkt punkt_tab
    ```

---

## Quick Start Guide

### 1. Get the Data
Download the file `AllPrintings.json` from [MTGJSON](https://mtgjson.com/downloads/all-files/). This file contains every Magic card ever made. Place it in the `data/` folder.

```bash
mkdir -p data
# (Move your downloaded AllPrintings.json to data/ folder)
```

### 2. Encode Cards (JSON -> Text)
Convert the JSON data into a simple text format for training.

```bash
# Basic encoding
python3 encode.py data/AllPrintings.json encoded_output.txt --verbose
```
*   **Input:** `data/AllPrintings.json`
*   **Output:** `encoded_output.txt` (A text file with one card per line/entry)

### 3. Decode Cards (Text -> Readable)
Convert encoded text (like the output from your AI) back into a readable format.

```bash
# Decode to plain text
python3 decode.py encoded_output.txt decoded_cards.txt
```

**Want to see images?**
Generate a file for Magic Set Editor (requires [MSE](https://magicseteditor.boards.net/) to be installed):
```bash
python3 decode.py encoded_output.txt my_new_set --mse
```
*   **Note:** This creates a file named `my_new_set.mse-set`. You can open this file directly in Magic Set Editor.

---

## Usage Details

### `encode.py` (Preparing Data)
Options to customize how the data is formatted:
*   `--encoding std`: Standard format (Name comes last). Default.
*   `--encoding named`: Name comes first.
*   `--encoding old`: Legacy format (Name comes first).
*   `--encoding vec`: Vectorized format (numbers representing words) for specific model types.
*   `--randomize`: Randomizes mana symbol order (e.g., `{U}{W}` vs `{W}{U}`) to help the AI generalize.

### `decode.py` (Viewing Results)
Options for formatting the output:
*   `--gatherer`: Formats text like the official Gatherer website (Default).
*   `--raw`: Disables Gatherer formatting and shows raw text.
*   `--html`: Creates a webpage (`.html`) with card images.
*   `--mse`: Creates a set file (`.mse-set`) for Magic Set Editor.
*   `--json`: Creates a structured JSON file.
*   `--csv`: Creates a CSV file for spreadsheets.

### `sortcards.py` (Organizing Output)
Organizes encoded cards into categories (like Color, Card Type, etc.) and wraps them in `[spoiler]` tags. This is useful for posting generated cards on forums.

```bash
python3 sortcards.py encoded_output.txt sorted_output.txt
```
*   **Note:** If your input file was not encoded using the default `std` format, use the `-e` flag to specify the correct encoding (e.g., `python3 sortcards.py ... -e named`).

### Training a Neural Network
*Note: This tool prepares the data. It does not train the model itself.*

1.  **Encode:** Use `encode.py` to create `input.txt`.
2.  **Train:** Use a tool like `mtg-rnn`, `char-rnn`, or a Transformer model on `input.txt`.
3.  **Generate:** Have your model produce text.
4.  **Decode:** Use `decode.py` to turn that text into cards.

---

## Troubleshooting

*   **Missing NLTK Data:** If you see an error about `punkt` or `punkt_tab` not found, run `python3 -m nltk.downloader punkt punkt_tab`.
*   **Missing `AllPrintings.json`:** Ensure the file is named exactly `AllPrintings.json` and is in the `data/` folder.
*   **MSE Fonts:** If your generated cards show squares instead of symbols, you are missing the required fonts (Beleren, Relay, MPlantin). See [DEPENDENCIES.md](DEPENDENCIES.md).

---

## Documentation & Help
*   [DEPENDENCIES.md](DEPENDENCIES.md): How to set up external tools like Magic Set Editor.
*   [AGENTS.md](AGENTS.md): Information for AI agents.
*   To run tests: `python3 -m pytest`
